rm -rf audio
mkdir audio
cd audio

echo "track [[[[440, 0, 5512], [440, 172, 5512]], [[440, 0, 4000], [440, 344, 4000]], [[440, 0, 5512], [440, 516, 5512]], [[440, 0, 4000], [440, 688, 4000]]],[[[493, 0, 5512], [493, 860, 5512]], [[493, 0, 5512], [493, 1032, 5512]], [[493, 0, 5512], [493, 1204, 5512]], [[493, 0, 4000], [493, 1376, 4000]]], [[[440, 0, 5512], [440, 1548, 5512]], [[440, 0, 4000], [440, 1720, 4000]], [[440, 0, 5512], [440, 1892, 5512]], [[440, 0, 4000], [440, 2064, 4000]]], [[[493, 0, 5512], [493, 2236, 5512]], [[493, 0, 5512], [493, 2408, 5512]], [[493, 0, 5512], [493, 2580, 5512]], [[493, 0, 4000], [493, 2752, 4000]]], [[[440, 0, 5512], [440, 2924, 5512]], [[440, 0, 4000], [440, 3096, 4000]], [[493, 0, 5512], [493, 3258, 5512]], [[493, 0, 4000], [493, 3440, 4000]]], [[[523, 0, 5512], [523, 3612, 5512]], [[523, 0, 4000], [523, 3784, 4000]], [[493, 0, 5512], [493, 3956, 5512]], [[493, 0, 4000], [493, 4128, 4000]]], [[[440, 0, 5512], [440, 4300, 5512]], [[440, 0, 4000], [440, 4472, 4000]], [[493, 0, 5512], [493, 4644, 5512]], [[440, 0, 5512], [440, 4816, 5512]]], [[[350, 0, 5512], [350, 4988, 5512]], [[350, 0, 5512], [350, 5160, 5512]], [[350, 0, 5512], [350, 5332, 5512]], [[350, 0, 4000], [350, 5504, 4000]]]]" > run_audio.scr

../.cabal-sandbox/bin/cryptol ../examples/funstuff/sincos.cry -b run_audio.scr > temp

state="s"
cur_sample=""

write_sample() {
    local sample="${cur_sample/0x/\\x}"
    echo -en "$sample" >> audio.pcm
    cur_sample=""
}

while read -n1 char; do
    case "$state" in
        s)  if [ "$char" == "[" ]; then
                state="t" 
            fi
            ;;
        t)  case "$char" in
            [) state="f";
               ;;
            ]) state="e";
               ;;
            esac
            ;;
        f)  case "$char" in
            [) state="a";
               ;;
            ]) state="t";
               ;;
            esac
            ;;
        a)  case "$char" in
            ,) write_sample
               ;;
            ]) write_sample
               state="f"
               ;;
            *) cur_sample+=$char
               ;;
            esac
            ;;
    esac
done < temp

ffmpeg -f s16be -ar 22.05k -ac 2 -i audio.pcm audio.wav
